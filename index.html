<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¶²ç«™æª”æ¡ˆç›®éŒ„</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }

        h1 {
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            margin: 10px 0;
            padding: 8px;
            background-color: #f9f9f9;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        li:hover {
            background-color: #f0f0f0;
        }

        a {
            color: #0366d6;
            text-decoration: none;
            display: block;
        }

        a:hover {
            text-decoration: underline;
        }

        .loading {
            text-align: center;
            color: #666;
        }

        .file-icon {
            margin-right: 10px;
        }

        .error {
            color: #d73a49;
            font-weight: bold;
        }

        .breadcrumb {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .breadcrumb a {
            display: inline;
            margin: 0 5px;
        }

        .back-link {
            margin-bottom: 15px;
            display: block;
        }
    </style>
</head>

<body>
    <h1>ç¶²ç«™æª”æ¡ˆç›®éŒ„</h1>

    <div id="breadcrumb" class="breadcrumb"></div>

    <div id="file-list">
        <p class="loading">è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const fileList = document.getElementById('file-list');
            const breadcrumbDiv = document.getElementById('breadcrumb');

            // é…ç½®ä¿¡æ¯ - GitHub ç”¨æˆ¶åå’Œå€‰åº«å
            const username = 'Axelisme';
            const repo = 'LabResult';

            // ç²å–ç•¶å‰è·¯å¾‘åƒæ•¸
            const urlParams = new URLSearchParams(window.location.search);
            let currentPath = urlParams.get('path') || '';

            // é¡¯ç¤ºéºµåŒ…å±‘å°èˆª
            function updateBreadcrumb() {
                breadcrumbDiv.innerHTML = '<strong>è·¯å¾‘ï¼š</strong>';
                const pathParts = currentPath.split('/').filter(part => part !== '');

                // æ·»åŠ æ ¹ç›®éŒ„é€£çµ
                const rootLink = document.createElement('a');
                rootLink.href = 'index.html';
                rootLink.textContent = 'æ ¹ç›®éŒ„';
                breadcrumbDiv.appendChild(rootLink);

                // æ§‹å»ºè·¯å¾‘
                let partialPath = '';
                pathParts.forEach((part, index) => {
                    breadcrumbDiv.appendChild(document.createTextNode(' > '));

                    partialPath += (index === 0 ? '' : '/') + part;
                    const link = document.createElement('a');
                    if (index === pathParts.length - 1) {
                        // ç•¶å‰ç›®éŒ„ä¸éœ€è¦é€£çµ
                        const span = document.createElement('span');
                        span.textContent = part;
                        breadcrumbDiv.appendChild(span);
                    } else {
                        link.href = `index.html?path=${encodeURIComponent(partialPath)}`;
                        link.textContent = part;
                        breadcrumbDiv.appendChild(link);
                    }
                });
            }

            // é¡¯ç¤ºå›åˆ°ä¸Šå±¤ç›®éŒ„çš„é€£çµ
            function addBackLink() {
                if (currentPath) {
                    const pathParts = currentPath.split('/').filter(part => part !== '');
                    if (pathParts.length > 0) {
                        const backDiv = document.createElement('div');
                        const backLink = document.createElement('a');
                        backLink.classList.add('back-link');

                        // å›åˆ°ä¸Šä¸€å±¤ç›®éŒ„
                        const parentPath = pathParts.slice(0, -1).join('/');
                        backLink.href = parentPath ? `index.html?path=${encodeURIComponent(parentPath)}` : 'index.html';
                        backLink.textContent = 'ğŸ“‚ ../ (å›åˆ°ä¸Šå±¤ç›®éŒ„)';

                        backDiv.appendChild(backLink);
                        return backDiv;
                    }
                }
                return null;
            }

            // æª¢æŸ¥æª”æ¡ˆæ˜¯å¦ç‚ºç¶²é æª”æ¡ˆ
            function isWebPage(filename) {
                const webExtensions = ['.html', '.htm', '.xhtml', '.php', '.asp', '.aspx', '.jsp'];
                const extension = filename.substring(filename.lastIndexOf('.')).toLowerCase();
                return webExtensions.includes(extension);
            }

            // ç²å–æŒ‡å®šè·¯å¾‘çš„å€‰åº«å…§å®¹
            function fetchDirectoryContents() {
                let apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/`;
                if (currentPath) {
                    apiUrl += currentPath;
                }

                fetch(apiUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('ç„¡æ³•ç²å–æª”æ¡ˆåˆ—è¡¨ã€‚è«‹ç¢ºèªå€‰åº«è¨­ç½®æ˜¯å¦æ­£ç¢ºã€‚');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // æ¸…é™¤è¼‰å…¥ä¿¡æ¯
                        fileList.innerHTML = '';

                        // æ›´æ–°éºµåŒ…å±‘å°èˆª
                        updateBreadcrumb();

                        // å‰µå»ºæª”æ¡ˆåˆ—è¡¨
                        const ul = document.createElement('ul');

                        // æ·»åŠ å›ä¸Šå±¤ç›®éŒ„é€£çµ
                        const backLink = addBackLink();
                        if (backLink) {
                            fileList.appendChild(backLink);
                        }

                        // éæ¿¾æ‰éš±è—æª”å’Œç•¶å‰çš„index.html
                        data.filter(item => !item.name.startsWith('.') && item.name !== 'index.html')
                            .sort((a, b) => {
                                // æ–‡ä»¶å¤¾å„ªå…ˆé¡¯ç¤º
                                if (a.type === 'dir' && b.type !== 'dir') return -1;
                                if (a.type !== 'dir' && b.type === 'dir') return 1;
                                // å­—æ¯é †åºæ’åº
                                return a.name.localeCompare(b.name);
                            })
                            .forEach(item => {
                                const li = document.createElement('li');
                                const a = document.createElement('a');

                                // è¨­ç½®åœ–æ¨™
                                const icon = document.createElement('span');
                                icon.classList.add('file-icon');
                                icon.textContent = item.type === 'dir' ? 'ğŸ“' : 'ğŸ“„';

                                // ç‚ºç›®éŒ„å’Œæª”æ¡ˆè¨­ç½®ç‰¹æ®Šè™•ç†
                                if (item.type === 'dir') {
                                    // æ§‹å»ºæ–°çš„è·¯å¾‘åƒæ•¸
                                    const newPath = currentPath
                                        ? currentPath + '/' + item.name
                                        : item.name;
                                    a.href = `index.html?path=${encodeURIComponent(newPath)}`;
                                } else {
                                    // æª¢æŸ¥æ˜¯å¦ç‚ºç¶²é æª”æ¡ˆ
                                    if (isWebPage(item.name)) {
                                        // ç¶²é æª”æ¡ˆç›´æ¥åœ¨ç•¶å‰é é¢é–‹å•Ÿ
                                        const pagePath = currentPath
                                            ? currentPath + '/' + item.name
                                            : item.name;
                                        // ä½¿ç”¨GitHub Pagesçš„URLæ ¼å¼
                                        a.href = `https://${username}.github.io/${repo}/${pagePath}`;
                                        // çµ¦ç¶²é æª”æ¡ˆä¸€å€‹ç‰¹æ®Šçš„åœ–æ¨™
                                        icon.textContent = 'ğŸŒ';
                                    } else {
                                        // å…¶ä»–æ–‡ä»¶ä¿æŒåŸæœ‰çš„è™•ç†æ–¹å¼
                                        a.href = item.html_url;
                                        a.target = "_blank"; // åœ¨æ–°çª—å£æ‰“é–‹æ–‡ä»¶
                                    }
                                }

                                a.textContent = item.name;
                                a.prepend(icon);

                                li.appendChild(a);
                                ul.appendChild(li);
                            });

                        fileList.appendChild(ul);
                    })
                    .catch(error => {
                        fileList.innerHTML = `<p class="error">éŒ¯èª¤ï¼š${error.message}</p>
                        <p>è«‹ç¢ºèªå€‰åº«è¨­ç½®æ˜¯å¦æ­£ç¢ºã€‚</p>`;
                        console.error('ç²å–æª”æ¡ˆåˆ—è¡¨å¤±æ•—:', error);
                    });
            }

            // åˆå§‹è¼‰å…¥
            fetchDirectoryContents();
        });
    </script>
</body>

</html>